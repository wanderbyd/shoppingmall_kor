<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
		<title> Detail </title>
	<th:block th:insert="utils/imports.html :: meta"></th:block>
	<th:block th:insert="utils/imports.html :: maincss"></th:block>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

	<link rel="stylesheet" href="css/button2.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@600;800&display=swap" rel="stylesheet">

	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
		integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
		crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>

	<!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© JS -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
		crossorigin="anonymous"></script>


	<!--ë¦¬ë·° ì“°ëŠ”ê³³ ê°€ìš´ë° ì •ë ¬-->
	<style>
		.custom-container {
			display: flex;
			justify-content: center;
			align-items: center;
			height: 40vh;
			/* ë†’ì´ë¥¼ í™”ë©´ ì „ì²´ ë†’ì´ë¡œ ì„¤ì •í•˜ì—¬ ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬í•©ë‹ˆë‹¤. */
		}

		.custom-form {
			width: 70%;
			max-width: 400px;
			padding: 30px;
			border: 1px solid #ccc;
			/* í¼ ì£¼ìœ„ì— í…Œë‘ë¦¬ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. */
			border-radius: 8px;
			/* í…Œë‘ë¦¬ë¥¼ ë‘¥ê¸€ê²Œ ë§Œë“­ë‹ˆë‹¤. */
		}

		/* - ë¦¬ë·° ë³´ì´ëŠ”ê³³ ì»¨í…ì¸  í‘œ í¬ê¸°*/
		#reviewList {
			display: flex;
			flex-wrap: wrap;
			justify-content: space-between;
			margin-top: 100px;
		}

		.review-row {
			flex: 10 1 calc(48% - 10px);
			/* 48% ë„ˆë¹„ë¡œ ì„¤ì •, ì—¬ë°±ì€ 10px */


			margin-bottom: 20px;
			/* í•˜ë‹¨ ì—¬ë°± ì¶”ê°€ */
			border: 1px solid #ddd;
			/* í…Œë‘ë¦¬ ì¶”ê°€ */
			padding: 100px;
			/* ë‚´ë¶€ ì—¬ë°± ì¶”ê°€ */
			box-sizing: border-box;
			/* í…Œë‘ë¦¬ì™€ ì—¬ë°±ì„ ìš”ì†Œì˜ í¬ê¸°ì— í¬í•¨ */
		}

		.review-contents {
			height: 100%;
			/* ë¦¬ë·° ë‚´ìš© ì»¨í…Œì´ë„ˆê°€ í–‰ì˜ ë†’ì´ë¥¼ 100%ë¡œ ì±„ìš°ë„ë¡ ì„¤ì • */
			display: flex;
			flex-direction: column;
			justify-content: space-between;
		}

		.text-center2 {
			margin: 100px auto;
			/* Auto for left and right margins */
			margin-bottom: 0;
			display: block;
			/* Ensures that it's a block-level element */
			text-align: center;
			/* Center the text inside the element */
		}

		/* ì´ë¯¸ì§€ì— í˜¸ë²„ íš¨ê³¼ ì¶”ê°€ */
		.hover-zoom {
			transition: transform 0.3s ease-in-out;
		}

		/* í˜¸ë²„ ì‹œ ì´ë¯¸ì§€ í™•ëŒ€ íš¨ê³¼ */
		.hover-zoom:hover {
			transform: scale(1.4);
			/*  í™•ëŒ€ */
		}


		/* Styles for the imagemodal */
		.imagemodal {
			display: none;
			position: fixed;
			z-index: 1;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgba(0, 0, 0, 0.9);
			padding-top: 250px;
		}

		.modal-content {
			margin: auto;
			display: block;
			max-width: 800px;
			max-height: 600px;
		}

		.modal-content img {
			width: 100%;
		}

		#hover-message {
			display: none;
			position: absolute;
			background-color: rgba(0, 0, 0, 0.7);
			color: #fff;
			padding: 0px;
			border-radius: 5px;
			white-space: nowrap;
			/* Prevent multiline messages */
			position: absolute;
			transform: translateX(-50%);
			left: 50%;
			bottom: 0%;
		}

		.image-container {
			position: relative;
			display: inline-block;
		}

		.hover-zoom {
			max-width: 80px;
			max-height: 80px;
		}

		.image-container:hover #hover-message {
			display: block;
		}



		.custom-container2 {
			text-align: center;
		}

		.custom-item2 {
			display: flex;
			justify-content: center;
			margin: 20px 0;
		}

		.custom-box2 {
			background-color: #3498db;
			padding: 10px;
			border-radius: 5px;
			text-align: center;
			width: 140px;

		}

		.custom-box2 a {
			color: #fff;
			text-decoration: none;
			font-weight: bold;
		}

		.custom-box2:hover {
			background-color: #2980b9;
		}
	</style>


	</style>


	<style>
		.summary-container {
			display: flex;
			flex-wrap: wrap;
		}

		.summary-info {
			flex: 1 1 calc(-20% -20px);
			/* 50% í­, ì—¬ë°± ì œì™¸ */
			float: right;
			width: 500px;
			height: 600px;
			padding: 2px;
			box-sizing: border-box;
			flex-basis: calc(20% - 20px);
			text-align: left;
			font-family: 'Noto Sans KR', sans-serif;
		}

		.showstep1 {
			max-height: 300px;
			overflow: hidden;
		}

		.showstep2 {
			max-height: 600px;
			overflow: hidden;
		}

		.content {
			height: 1000px;
			text-align: center;

		}

		.hide {
			display: none;
		}

		.detailinfo {
			max-height: 300px;
			overflow: hidden;
		}

		.detailinfo.showstep2 {
			max-height: none;
			/* ì´ë¯¸ì§€ ì„¹ì…˜ì´ í¼ì³ì§ˆ ë•Œ ìµœëŒ€ ë†’ì´ í•´ì œ */
		}

		.content {
			height: auto;
			/* ì´ë¯¸ì§€ ì„¹ì…˜ì´ í¼ì³ì§ˆ ë•Œ ë‚´ìš© ë†’ì´ ìë™ ì¡°ì ˆ */
		}

		#slider {
			overflow: hidden;
			position: relative;
			/* border: 20px solid red; */
			/* // ì´ë¯¸ì§€ ë³´ì—¬ì§€ëŠ” ë·° ë¶€ë¶„ë§Œí¼ pxì¡°ì ˆ */
			margin-left: auto;
			margin-right: auto;
			width: 1200px;
			height: 200px;
			box-sizing: border-box;

		}

		.image-box {
			/* ì›ë³¸+í´ë¡ ì˜ ì´ í•© */
			width: 2100px;
			height: 100%;
			display: flex;
			flex-wrap: wrap;
			animation: bannermove 20s linear infinite;
			margin-right: 1500px;

		}

		.image-box>div {
			margin: 0px -1px 0px 0px;
		}

		@keyframes bannermove {
			0% {
				transform: translate(0, 0);
			}

			100% {
				transform: translate(-50%, 0);
			}
		}
	</style>
</head>

<!-- í˜ì´ì§€ ìƒë‹¨ì— í˜„ì¬ ì•„ì´í…œì˜ ì•„ì´ë””ë¥¼ ì €ì¥í•˜ëŠ” input ì¶”ê°€ -->
<input type="hidden" id="currentItemId" th:value="${item.itemid}" />

<body>
	<th:block th:insert="utils/header.html :: header"></th:block>
	<div class="container" style="border: none; margin-top: 0px;">
		<div class="row">
			<div class="col-sm-11 padding-right">
				<div class="product-details">
					<div class="col-sm-5">
						<div class="view-product" style="border: none;">
							<img th:src="${#strings.replace(item.getImagePath(), '/static/', '')}" alt="" th:width="450"
								th:height="500" />
						</div>
					</div>
					<div class="summary-info" style="padding: 20px;">
						<h2 style="  text-align: center; font-size: 24px; margin-bottom: 20px; color: gray;"
							th:text="${item.name}"></h2>
						<br>
						<div style="border: solid 1px rgb(192, 192, 192)"></div>
						<br><br>
						<a th:if="${session['loggedInUser'] != null and session['loggedInUser'].email == 'admin@admin.com'}"
							th:href="'editItem?itemid='+${item.getItemid()}">
							<i class="fa fa-edit" style="font-size: 30px; position: absolute; top: 0; right: 0;"></i>
						</a>








						<th:block th:if="${item.isSale()}">
							<div style="left: 500px;">
								<img src="images/home/sale.png" class="newarrival" alt="" />
							</div>
						</th:block>
						<table>
							<thead>
								<tr>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th scope="row">
										<span style="font-size: 17px; color: #555555; margin-right: 30px;">ìƒí’ˆìš”ì•½ì •ë³´</span>
									</th>
									<td>
										<span style="font-size: 13px; color: #555555;"
											th:text="${item.getDescription()}"></span>
									</td>
								</tr>

							</tbody>
						</table>
						<br>
						<table>
							<thead>
								<tr>
									<th></th>
								</tr>
							</thead>
							<tbody>

								<tr>
									<th scope="row">
										<span style="font-size: 17px; color: #555555; margin-right: 30px; ">ê°€ê²©&emsp;
											&emsp; &ensp; &ensp; </span>
									</th>


									<td>
										<span style="font-size: 13px; color: #555555"
											th:text="${item.getPrice() + 'ì›'}"></span>

									</td>
								</tr>
							</tbody>
						</table>
						<br>

						<table>
							<thead>
								<tr>
									<th></th>
								</tr>
							</thead>
							<tbody>

								<tr>
									<th scope="row">
										<span style="font-size: 17px; color: #555555; margin-right: 30px; ">ìˆ˜ëŸ‰&emsp;
											&emsp; &ensp; &ensp; </span>
									</th>
									<td>
										<span style="font-size: 13px; color: #555555"
											th:text="${item.getStock()}">ê°œ</span>
									</td>
								</tr>
							</tbody>
						</table>
						<br>
						<table>
							<thead>
								<tr>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th scope="row">
										<span style="font-size: 17px; color: #555555; margin-right: 30px; ">ì¹´í…Œê³ ë¦¬&emsp;
											&ensp; </span>
									</th>
									<td>
										<span style="font-size: 13px; color: #555555"
											th:text="${item.getCategory()}"></span>
									</td>
								</tr>
							</tbody>
						</table>
						<br><br><br><br>
						<a href="" style="position: absolute; top: 10; right: 350px;"
							th:href="'/cart?itemid=' + ${item.getItemid()}" class="button btnFloat btnBlueGreen">
							<i class="fa fa-shopping-cart"></i>
						</a>
					</div>
				</div>
			</div>
		</div>

	</div>











	<table>
		<div id="slider">
			<div class="image-box">
				<div><img class="" src="/images/home/img1.png" alt=""></div>
				<div><img class="" src="/images/home/img2.png" alt=""></div>
				<div><img class="" src="/images/home/img3.jpg" alt=""></div>
				<div><img class="" src="/images/home/img4.jpg" alt=""></div>
				<div><img class="" src="/images/home/img5.jpg" alt=""></div>
				<div><img class="" src="/images/home/img6.jpg" alt=""></div>
				<div><img class="" src="/images/home/img7.png" alt=""></div>
				<div><img class="" src="/images/home/img8.png" alt=""></div>
				<div><img class="" src="/images/home/img9.png" alt=""></div>
				<div><img class="" src="/images/home/img10.png" alt=""></div>
			</div>
		</div>
	</table>
	<br><br><br><br><br>
	<div class="custom-container2">
		<div class="custom-item2">
			<div class="custom-box2">
				<a href="#detail">ìƒì„¸ë³´ê¸°</a>
			</div>
			&ensp;
			<div class="custom-box2">
				<a href="#reviewListContainer">ë¦¬ë·°</a>
			</div>
			&ensp;
			<div class="custom-box2">
				<a href="#qna">Q&A</a>
			</div>
		</div>
	</div>

	<!-- ì´ë¯¸ì§€ ì„¹ì…˜ ì¶”ê°€ --><!-- ì´ë¯¸ì§€ ì„¹ì…˜ ì¶”ê°€ -->
	<section id="detail">

		<hr style="width:66%;height:10px;border:none;background-color:rgb(64, 128, 128);">
		<div class="container" style="border: none;">
			<!-- Add a horizontal line -->
			<div class="row justify-content-center">
				<div class="col-sm-12">
					<h2>ìƒì„¸ë³´ê¸°</h2>
					<tbody>
						<tr>
							<td>
								<div class="detailinfo showstep1">
									<div class="content">
										<img th:src="${#strings.replace(item.getImagePath2(), '/static/', '')}"
											alt="" />
									</div>
								</div>
								<a href="" class="button btnFloat btn_open"></a><a href=""
									class="button btnFloat btn_close"></a>
							</td>
						</tr>
					</tbody>
					<table>
						<thead>
							<tr>
								<th></th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
	</section>

	<section>

		<!-- ë¦¬ë·° ëª©ë¡ ë° ì—…ë°ì´íŠ¸ ëª¨ë‹¬ -->
		<div id="reviewListContainer">

			<div th:if="${not #lists.isEmpty(reviews)}" id="reviewList" class="container">
				<div class="row">
					<h5 class="text-center"><strong>REVIEW</strong></h5>
					<div class="col-md-12">
						<div class="table-responsive">
							<table class="table table-bordered">
								<thead>
									<tr>
										<th>ë¦¬ë·° ë²ˆí˜¸ã€€ã€€ã€€</th>
										<th>ë¦¬ë·° ì•„ì´í…œã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</th>
										<th>ë¦¬ë·° ì‚¬ì§„ã€€ã€€ã€€</th>
										<th>ë¦¬ë·° ë‚´ìš©ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€</th>
										<th>ë¦¬ë·° ìœ ì €ã€€ã€€ã€€</th>
										<th>ì¢‹ì•„ìš”ã€€ã€€</th>
										<th>ìˆ˜ì •</th>
										<th>ì‚­ì œ</th>

									</tr>
								</thead>
								<tbody>
									<tr th:each="review : ${reviews}">
										<td th:text="${review.displayNumber != null ? review.displayNumber : 'ğŸˆìƒˆ ë¦¬ë·°'}">
										</td>
										<td th:text="${review.item.name}"></td>
										<td>
											<div class="image-container">
												<img th:src="@{/getImage/{rvid}(rvid=${review.rvid})}"
													style="max-width: 80px; max-height: 80px;" class="hover-zoom"
													 
													onclick="openModal(this, 'imagemodal');">
												<div id="hover-message">ğŸ”</div>
											</div>
										</td>
										<td th:text="${review.contents}"></td>
										<td th:text="${#strings.substring(review.users.firstname, 0, 1)} + '****'"></td>

										<td>
											<button th:if="${loggedInUser != null}"
												th:class="${loggedInUser != null} ? 'btn btn-success' : 'btn btn-outline-success'"
												th:onclick="'javascript:likeReview(' + ${review.rvid} + '); javascript:updateLikes(' + ${review.rvid} + ')'"
												th:text="'ğŸ˜' + ${review.likes}"></button>

											<button th:unless="${loggedInUser != null}"
												th:class="${loggedInUser != null} ? 'btn btn-success' : 'btn btn-outline-success'"
												th:onclick="'javascript:void(0);'"
												th:text="'ğŸ˜' + ${review.likes}"></button>
										</td>

										<td>
											<button type="button" class="btn btn-warning" data-toggle="modal"
												th:data-target="'#updateReviewModal' + ${review.rvid}"
												th:if="${loggedInUser != null and review.users != null and (loggedInUser.email == 'admin@admin.com' or review.users.usersid == loggedInUser.usersid)}">
												ìˆ˜ì •
											</button>


											<!-- ì—…ë°ì´íŠ¸ ëª¨ë‹¬ í¼ -->
											<div th:id="'updateReviewModal' + ${review.rvid}" class="modal fade"
												tabindex="-1" role="dialog">
												<div class="modal-dialog" role="document">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title">ë¦¬ë·° ìˆ˜ì •</h5>
															<button type="button" class="close" data-dismiss="modal"
																aria-label="Close">
																<span aria-hidden="true">&times;</span>
															</button>
														</div>
														<div class="modal-body">
															<form th:action="@{/updateReview}" method="post">
																<input type="hidden" name="rvid"
																	th:value="${review.rvid}" />
																<input type="hidden" name="itemid"
																	th:value="${review.item.itemid}" />
																<input type="hidden" name="usersid"
																	th:value="${review.users.usersid}" />

																<div class="form-group">
																	<textarea name="contents" class="form-control"
																		rows="2" placeholder="Your Updated Review"
																		th:text="${review.contents}"></textarea>
																</div>
																<button type="submit"
																	class="btn btn-primary">Update</button>
															</form>
														</div>

													</div>
												</div>
											</div>
										</td>
										<td>

											<a th:if="${loggedInUser != null and (loggedInUser.email == 'admin@admin.com' or review.users != null and review.users.usersid == loggedInUser.usersid)}"
												th:href="@{/deleteReview/{rvid}(rvid=${review.rvid})}"
												class="btn btn-danger">
												ì‚­ì œ
											</a>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
			<p th:if="${#lists.isEmpty(reviews)}" class="text-center2">ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ë¦¬ë·°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”.ğŸˆ</p>

		</div>


		<div class="custom-container">
			<div class="custom-form">

				<form th:action="@{/addReview}" method="post" class="my-2 text-center" style="margin: auto;"
					enctype="multipart/form-data">
					<input type="hidden" name="itemid" th:value="${item.getItemid()}" />
					<input type="hidden" name="usersid" th:value="${users}" />

					<!-- ë³„ì  ì„ íƒ -->
					<div class="form-group">
						<label for="rating">WRITEğŸ“ </label>
						<select name="rating" class="form-control" id="rating" onchange="updateContentsWithRating()">
							<option value="none">â­ ì„ íƒ</option>
							<option value="â­ ">â­</option>
							<option value="â­â­ ">â­â­</option>
							<option value="â­â­â­ ">â­â­â­</option>
							<option value="â­â­â­â­ ">â­â­â­â­</option>
							<option value="â­â­â­â­â­ ">â­â­â­â­â­</option>
						</select>
					</div>


					<!-- ë¦¬ë·° ë‚´ìš© -->
					<div class="form-group">
						<textarea name="contents" id="contents" class="form-control" rows="2"
							placeholder="Your Review"></textarea>
					</div>

					<div class="form-group">
						<label for="reviewImage"></label>
						<input multiple type="file" name="reviewImage" accept="image/*">
					</div>

					<script>
						// ë³„ì ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
						function updateContentsWithRating() {
							// ì„ íƒëœ ë³„ì ì„ ê°€ì ¸ì™€ì„œ "ë³„ì : "ê³¼ í•¨ê»˜ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
							var selectedRating = document.getElementById("rating").value;
							var updatedContents = "" + selectedRating;

							// ë¦¬ë·° ë‚´ìš© ì—…ë°ì´íŠ¸
							document.getElementById("contents").value = updatedContents;
						}
					</script>

					<button type="submit" class="btn btn-primary">Submit</button>
				</form>
			</div>




	</section>


	<!--*ì¶”ê°€*-->

	<body onload="fetchAndDisplayAnswers()">
		<div th:if="${successMessage}" class="success-message">
			<script th:inline="javascript">
				/* Retrieve the success message from the model */
				var successMessage = /*[[${successMessage}]]*/ '';

				/* Check if the success message exists and display it using JavaScript */
				if (successMessage) {
					alert(successMessage);
				}
			</script>
		</div>
		<section id="qna">
			<div class="container">
				<h3>Q&A</h3>

				<div class="row">
					<div class="col-sm-12">
						<table style="border-collapse: collapse; width: 100%; font-family: 'Noto Sans KR', sans-serif;">
							<thead>
								<tr style="border-bottom: #dddddd 1px solid; border-top: #dddddd 1px solid;">
									<th
										style="text-align: center; padding-top: 8px; border-left: #dddddd 1px solid; padding-bottom: 8px; width: 100px;">
										ìƒí’ˆëª…
									</th>
									<th style="text-align: center; border-left: #dddddd 1px solid;  width: 100px;">ì•„ì´ë””
									</th>
									<th style="text-align: center; border-left: #dddddd 1px solid; width: 500px;">ì§ˆë¬¸
									</th>
									<th style="text-align: center; border-left: #dddddd 1px solid; width: 500px;">ë‹µë³€
									</th>
									<th
										style="text-align: center; border-left: #dddddd 1px solid; width: 100px; border-right: #dddddd 1px solid;">
										ì‚­ì œ</th>
									<th style="text-align: center; border-right: #dddddd 1px solid; width: 100px;">ìˆ˜ì •
									</th>
								</tr>
							</thead>
							<tbody>
								<tr style="border-bottom: #dddddd 1px solid;" th:each="qna, iterStat : ${qnaList}"
									th:class="'item-' + ${iterStat.count}">
									<td style="text-align: center; border-left: #dddddd 1px solid;"><span
											th:text="${item.name}" class="qna-name"></span></td>
									<td style="text-align: center; border-left: #dddddd 1px solid;"><span
											th:text="${#strings.substring(qna.users.firstname, 0, 1)} + '****'"></span>
									</td>
									<td style="border-left: #dddddd 1px solid; border-right: #dddddd 1px solid;">
										<ul class="qna">
											<li>
												<input type="checkbox" th:id="'qna-' + ${qna.qnaid}">
												<label th:for="'qna-' + ${qna.qnaid}" class="qna-label">
													<span th:text="${qna.question}" class="qna-content"></span>
												</label>
												<div class="qna-details" th:id="'qna-details-' + ${qna.qnaid}">
													<p th:text="${qna.question}" class="qna-content"></p>
												</div>
											</li>
										</ul>
									</td>
									<th:block th:if="${session.isAdmin}">
										<td style="text-align: right;">
											<div class="answerSection"
												style="display: flex; justify-content: space-between; gap: 8px;">
												<form class="answerFormContent" method="post">
													<input type="hidden" name="qnaid" th:value="${qna.qnaid}">
													<textarea name="answer" rows="2" cols="50"
														placeholder="ë‹µë³€ ë‚´ìš©"></textarea>
													<button type="submit" class="btn btn-info">í™•ì¸</button>
												</form>
												<div class="answerContent" style="display: none;"></div>
												<button class="editButton"><i class="fas fa-edit"
														style="color: gray;"></i></button>
											</div>
										</td>

									</th:block>

									<th:block th:unless="${session.isAdmin}" style="border-left: #dddddd 1px solid;">
										<td>
											<div class="answerContent">
												<p th:if="${qna.answer != null}" th:text="${qna.answer}"></p>
												<p th:if="${qna.answer == null}">ë‹µë³€ì´ ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
											</div>
										</td>
									</th:block>
									<td
										style="text-align: center; border-left: #dddddd 1px solid; border-right: #dddddd 1px solid;">
										<form class="deleteForm" th:action="@{/delete/{qnaid}(qnaid=${qna.qnaid})}"
											method="post">
											<button type="submit" class="btn btn-danger">ì‚­ì œ</button>
										</form>
									</td>
									<td style="border-right: solid 1px #dddddd ; text-align: center;">
										<form th:action="@{/edit}" method="get">
											<input type="hidden" name="qnaid" th:value="${qna.qnaid}">
											<!--<button type="submit" class="btn btn-success">ìˆ˜ì •</button>-->
											<button class="btn btn-success">ìˆ˜ì •</button>
										</form>

									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<br><br>
				<form action="/popup" method="POST" style="text-align: right;">
					<input type="hidden" name="itemid" th:value="${item.getItemid()}">
					<button type="submit">ë¬¸ì˜í•˜ê¸°</button>
				</form>
			</div>
		</section>
	</body>






	<br><br><br><br><br><br>
	<div style="width: 66%; margin-left:auto;margin-right: auto;">
		<th:block th:insert="utils/footer.html :: footer"></th:block>
	</div>
	<th:block th:insert="utils/imports.html :: mainjs"></th:block>


	<script>
		$(document).ready(function () {
			// ì´ˆê¸°ì— í•œ ë²ˆ ë¦¬ë·° ëª©ë¡ì„ ê°€ì ¸ì˜´
			updateReviewList();


			// ë¦¬ë·° ëª©ë¡ì„ ê°€ì ¸ì˜¤ê³  ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸
			function updateReviewList() {
				// í˜„ì¬ ì•„ì´í…œì˜ ì•„ì´ë””ë¥¼ ì¶”ì¶œ
				var currentItemId = $("#currentItemId").val();

				// ì„œë²„ì—ì„œ í˜„ì¬ ì•„ì´í…œì˜ ë¦¬ë·° ëª©ë¡ì„ ë¹„ë™ê¸°ë¡œ ê°€ì ¸ì˜¤ê¸°
				$.get("/reviews/" + currentItemId, function (data) {
					// ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ë¦¬ë·° ëª©ë¡(data)ì„ ì‚¬ìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸
					$("#reviewListContainer").html(data);

					// ì—…ë°ì´íŠ¸ ë²„íŠ¼ì— ëŒ€í•œ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
					$('.btn-warning').click(function () {
						var targetModalId = $(this).attr('data-target');

						// ëª¨ë‹¬ì„ ê°•ì œë¡œ ì—´ê¸°
						$(targetModalId).modal('show');
					});
				});
			}
		});

		function displayMessage(event) {
			var hoverMessage = document.getElementById('hover-message');
			hoverMessage.style.top = (event.clientY + window.scrollY) + 'px';
			hoverMessage.style.left = (event.clientX + window.scrollX) + 'px';
			hoverMessage.style.display = 'block';
		}

		function hideMessage() {
			var hoverMessage = document.getElementById('hover-message');
			hoverMessage.style.display = 'none';
		}

		function openModal(imgElement, modalType) {
			// Check if modal is already open to prevent duplicates
			if (document.querySelector('.' + modalType)) {
				return;
			}

			// Hide the hover message when modal is opened
			hideMessage();

			var modal = document.createElement('div');
			modal.className = modalType; // Use the provided modalType

			var modalContent = document.createElement('img');
			modalContent.src = imgElement.src;
			modalContent.className = 'modal-content';

			modal.appendChild(modalContent);

			document.body.appendChild(modal);

			modal.style.display = 'block';

			// Modal click to close logic
			modal.onclick = function () {
				modal.style.display = 'none';
				document.body.removeChild(modal);
			};
		}



		function likeReview(rvid) {
			// Ajaxë¥¼ ì´ìš©í•œ ì„œë²„ í†µì‹ 
			// jQueryë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
			$.ajax({
				type: 'POST',
				url: '/likeReview/' + rvid,
				success: function (response) {
					// ì—…ë°ì´íŠ¸ê°€ ì„±ê³µí–ˆì„ ë•Œì˜ ì²˜ë¦¬
					// ì˜ˆë¥¼ ë“¤ì–´, ì¢‹ì•„ìš” ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ ë²„íŠ¼ì˜ ìŠ¤íƒ€ì¼ì„ ë³€ê²½í•˜ëŠ” ë“±

					// Assuming the response contains the updated like count
					var updatedLikeCount = response.likeCount;

					// Update the like count in the UI
					var likeCountElement = $('#likeCount_' + rvid);
					likeCountElement.text(updatedLikeCount);

					console.log('ì¢‹ì•„ìš”ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
				},
				error: function (error) {
					// ì—ëŸ¬ ì²˜ë¦¬
					console.error('ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
				}
			});
		}


		function updateLikes(rvid) {
			$.ajax({
				type: 'POST',
				url: '/updateLikes',
				data: {rvid: rvid},
				success: function (response) {
					console.log('updateLikes Success:', response);

					// Assuming you want to update the UI with the new like count
					var likeCountElement = $('#likeCount_' + rvid);
					likeCountElement.text(parseInt(likeCountElement.text()));

					// Reload the page after the like is updated
					location.reload();
				},
				error: function (error) {
					console.error('updateLikes Error:', error);
				}
			});
		}



	</script>







	<script>

		document.addEventListener("DOMContentLoaded", function () {

			// ëª¨ë“  í´ë˜ìŠ¤ê°€ "price"ì¸ ìš”ì†Œë¥¼ ì„ íƒ ê°•í¬ì”¨ ì†ŒìŠ¤

			var priceElements = document.querySelectorAll(".price");



			// ê° ìš”ì†Œì— ëŒ€í•´ ë°˜ë³µ

			priceElements.forEach(function (priceElement) {

				var price = priceElement.textContent;



				// ì‰¼í‘œ ì¶”ê°€ ë¡œì§

				var formattedPrice = parseFloat(price).toLocaleString('en-US');



				// ê²°ê³¼ë¥¼ ë‹¤ì‹œ h2 ìš”ì†Œì— ì„¤ì •

				priceElement.textContent = formattedPrice + 'ì›';

			});

		});

	</script>



	<!--<script>

function openPopup() {

window.open('/popup', 'íŒì—…', 'width=800,height=600');

}

 

</script>-->



	<script>

		function openPopup() {



			fetch('/check-login-status', {

				method: 'GET',

				credentials: 'include'

			})



				.then(response => {

					if (response.ok) {

						// ë¡œê·¸ì¸ë˜ì–´ ìˆì„ ë•Œ íŒì—… ì—´ê¸°

						window.open('/popup', '_blank', 'width=800,height=600');

					} else {

						// ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•Šì„ ë•Œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™

						window.location.href = '/login';

					}

				})

				.catch(error => {

					console.error('ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);

				});

		}

	</script>


	<!-- Q&A -->
	<!-- ì‚­ì œ -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		$(document).ready(function () {
			// í´ë˜ìŠ¤ë¥¼ í†µí•œ ì‚­ì œ ì´ë²¤íŠ¸ ë°”ì¸ë”©
			$('.deleteForm').submit(function (event) {
				event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë°©ì§€

				if (confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
					var qnaId = $(this).attr('action').split('/').pop(); // ì‚­ì œí•  QnA ID ê°€ì ¸ì˜¤ê¸°

					// QnA ì‚­ì œë¥¼ ìœ„í•œ AJAX ìš”ì²­ ë³´ë‚´ê¸°
					$.ajax({
						type: 'POST',
						url: '/delete/' + qnaId,
						success: function (response) {
							alert(response); // ì‚­ì œ ì„±ê³µ ë©”ì‹œì§€ ë³´ì—¬ì£¼ê¸°
							if (response.includes('ì‚­ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.')) {
								window.location.reload();
							}
						},
						error: function (xhr, status, error) {
							// ì˜¤ë¥˜ ë©”ì‹œì§€ ì²˜ë¦¬
							if (xhr.status === 401) {
								alert('ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤!!');
							} else if (xhr.status === 404) {
								alert('ìš”ì²­í•œ QnAê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!!');
							} else {
								alert('ì‚­ì œë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¤‘ì— ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!!');
							}
						}
					});
				} else {
					console.log("ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");
				}
			});
		});
	</script>


	<!-- ë‹µë³€ -->

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		$(document).ready(function () {
			function fetchAndDisplayAnswers() {
				$('.answerFormContent').each(function () {
					var qnaId = $(this).find('input[name="qnaid"]').val();
					var savedAnswer = localStorage.getItem('answer_' + qnaId);

					if (savedAnswer) {
						$(this).hide();
						$(this).siblings('.answerContent').text(savedAnswer).show();
						$(this).siblings('.deleteButton').show(); // Show delete button if answer exists
					}
				});
			}

			fetchAndDisplayAnswers();


			$('.editButton').each(function () {
				var answerContent = $(this).siblings('.answerContent');
				var savedAnswer = answerContent.text().trim(); // ë‹µë³€ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°

				// ë‹µë³€ ë‚´ìš©ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ ìˆ˜ì • ë²„íŠ¼ í‘œì‹œ
				if (savedAnswer !== '') {
					$(this).show();
				} else {
					$(this).hide();
				}
			});

			$('.editButton').click(function () {
				var form = $(this).siblings('.answerFormContent');
				var answerContent = $(this).siblings('.answerContent');
				var qnaId = form.find('input[name="qnaid"]').val();

				// ì´ì „ì— ì €ì¥ëœ ë‹µë³€ ë‚´ìš©ì„ ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ê°€ì ¸ì˜´
				var savedAnswer = localStorage.getItem('answer_' + qnaId);

				// í¼ì„ ìˆ˜ì • ê°€ëŠ¥í•œ ìƒíƒœë¡œ ì„¤ì •í•˜ê³  ì´ì „ ë‚´ìš©ì„ ì±„ì›Œë„£ìŒ
				form.find('textarea[name="answer"]').val(savedAnswer);
				form.show(); // í¼ì„ ë³´ì—¬ì¤Œ
				answerContent.hide(); // ë‹µë³€ ë‚´ìš©ì„ ìˆ¨ê¹€
			});


			$('.answerFormContent').submit(function (event) {
				event.preventDefault();

				var form = $(this);
				var qnaId = form.find('input[name="qnaid"]').val();
				var formData = form.serialize();

				$.ajax({
					type: form.attr('method'),
					url: '/answer', // ì´ ë¶€ë¶„ì€ ì‹¤ì œ ì„œë²„ì˜ ì—”ë“œí¬ì¸íŠ¸ë¡œ ìˆ˜ì •ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
					data: formData,
					success: function (response) {
						form.hide();
						form.siblings('.answerContent').text(response).show();

						// ë‹µë³€ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•©ë‹ˆë‹¤.
						localStorage.setItem('answer_' + qnaId, response);

						// ë‹µë³€ì„ ë‹¬ê³  ìˆ˜ì • ë²„íŠ¼ì„ ë°”ë¡œ ë³´ì´ë„ë¡ ì²˜ë¦¬
						form.siblings('.editButton').show();
					},
					error: function (xhr, status, error) {
						console.error(error);
					}
				});
			});
		});
	</script>


</body>

</html>